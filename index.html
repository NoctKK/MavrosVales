<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÎœÎ±ÏÏÎ¿Ï‚ Î’Î±Î»Î­Ï‚ - Online</title>
    <style>
        :root { 
            --green: #1a472a; 
            --gold: #d4af37; 
            --red-glow: rgba(255, 0, 0, 0.8); 
            --bg-gradient: radial-gradient(circle, #2e5c3e 0%, #1a472a 100%);
        }
        
        body { 
            background: var(--bg-gradient); 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            overflow: hidden; 
            height: 100vh; 
            user-select: none; 
            -webkit-user-select: none;
        }

        /* --- ÎŸÎ˜ÎŸÎÎ— Î•ÎÎ‘Î¡ÎÎ—Î£ --- */
        #start-screen { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.95); 
            z-index: 2000; 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
        }
        
        button.start-btn { 
            padding: 20px 50px; 
            font-size: 22px; 
            background: var(--gold); 
            color: #222;
            border: none; 
            border-radius: 50px; 
            cursor: pointer; 
            font-weight: bold; 
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5); 
            transition: transform 0.2s;
        }
        button.start-btn:active { transform: scale(0.95); }

        /* --- Î•ÎÎ”Î•Î™ÎÎ— Î£Î•Î™Î¡Î‘Î£ --- */
        #turn-indicator {
            position: fixed; top: 15px; left: 50%; transform: translateX(-50%);
            padding: 10px 25px; 
            background: rgba(0,0,0,0.8);
            border: 2px solid #555; 
            border-radius: 20px;
            font-size: 16px; 
            font-weight: bold; 
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        /* --- Î¤Î¡Î‘Î Î•Î–Î™ --- */
        #table { width: 100%; height: 100%; position: relative; }

        /* --- Î‘ÎÎ¤Î™Î Î‘Î›ÎŸÎ™ --- */
        .opponent { position: absolute; display: flex; flex-direction: column; align-items: center; pointer-events: none; }
        .opp-name { background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 5px; font-size: 12px; margin-bottom: 2px; color: #ddd; }
        
        .opp-top { top: 60px; left: 50%; transform: translateX(-50%); }
        .opp-left { left: 20px; top: 40%; transform: translateY(-50%); }
        .opp-right { right: 20px; top: 40%; transform: translateY(-50%); }
        
        .mini-hand { display: flex; justify-content: center; }
        .mini-card { 
            width: 25px; height: 38px; 
            background: linear-gradient(135deg, #a00, #500); 
            border: 1px solid white; border-radius: 3px; 
            margin-left: -18px; /* Î•Ï€Î¹ÎºÎ¬Î»Ï…ÏˆÎ· */
            box-shadow: 1px 1px 3px black;
        }
        .mini-card:first-child { margin-left: 0; }

        /* --- ÎšÎ•ÎÎ¤Î¡ÎŸ (Î£Î¤ÎŸÎ™Î’Î•Î£) --- */
        .center-stack {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: flex; gap: 30px; align-items: center;
        }
        
        /* --- Î£Î§Î•Î”Î™Î‘Î£ÎœÎŸÎ£ Î¦Î¥Î›Î›ÎŸÎ¥ --- */
        .card {
            width: 80px; height: 120px;
            background: white; color: black;
            border-radius: 8px; border: 1px solid #999;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 5px; box-sizing: border-box;
            position: relative; font-weight: bold; font-size: 18px;
            box-shadow: 2px 4px 10px rgba(0,0,0,0.4);
            cursor: pointer; transition: transform 0.2s;
        }
        .card.red { color: #d00; }
        .card.back { 
            background: linear-gradient(135deg, #8e2424 0%, #4d0000 100%); 
            border: 2px solid white; 
            display: flex; align-items: center; justify-content: center;
        }
        .card:hover { transform: translateY(-15px) scale(1.05); z-index: 50; }
        .card:active { transform: scale(0.95); }

        /* Î£ÏÎ¼Î²Î¿Î»Î± ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ */
        .suit-center { font-size: 40px; align-self: center; line-height: 1; }
        .corner-top { line-height: 0.8; }
        .corner-bottom { transform: rotate(180deg); line-height: 0.8; }

        /* --- Animations Î›Î¬Î¸Î¿Ï…Ï‚ --- */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; border: 2px solid red !important; box-shadow: 0 0 15px red; }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); } 
            20%, 80% { transform: translate3d(2px, 0, 0); } 
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 
            40%, 60% { transform: translate3d(4px, 0, 0); } 
        }

        /* --- Î¤ÎŸ Î§Î•Î¡Î™ ÎœÎŸÎ¥ --- */
        #my-hand {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: center; height: 140px;
            padding-bottom: 10px;
        }
        .hand-card { 
            margin-left: -45px; /* ÎœÎµÎ³Î¬Î»Î· ÎµÏ€Î¹ÎºÎ¬Î»Ï…ÏˆÎ· Î³Î¹Î± Î½Î± Ï‡Ï‰ÏÎ¬Î½Îµ 11 */
            transition: margin 0.2s, transform 0.2s; 
            transform-origin: bottom center;
        }
        .hand-card:first-child { margin-left: 0; }
        .hand-card:hover { margin-right: 20px; z-index: 100; transform: translateY(-30px) scale(1.1); }

        /* --- ÎšÎŸÎ¥ÎœÎ Î™Î‘ --- */
        #controls { 
            position: absolute; bottom: 180px; right: 20px; 
            display: flex; gap: 10px; flex-direction: column;
        }
        .action-btn { 
            padding: 12px 25px; 
            background: rgba(0,0,0,0.6); 
            color: white; 
            border: 1px solid var(--gold); 
            border-radius: 25px; 
            cursor: pointer; 
            font-weight: bold;
            backdrop-filter: blur(5px);
        }
        .action-btn:hover { background: var(--gold); color: black; }

        /* Responsive Î³Î¹Î± ÎºÎ¹Î½Î·Ï„Î¬ */
        @media (max-width: 600px) {
            .card { width: 60px; height: 90px; font-size: 14px; }
            .suit-center { font-size: 25px; }
            .hand-card { margin-left: -35px; }
            .center-stack { gap: 15px; }
            #turn-indicator { font-size: 14px; padding: 8px 15px; width: 80%; }
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color: var(--gold); margin-bottom: 20px; text-shadow: 2px 2px 0 #000;">ÎœÎ±ÏÏÎ¿Ï‚ Î’Î±Î»Î­Ï‚ â™ ï¸</h1>
        <button class="start-btn" onclick="socket.emit('startGameRequest')">ÎÎ•ÎšÎ™ÎÎ—Î£Î• Î¤ÎŸ ÎœÎŸÎ™Î¡Î‘Î£ÎœÎ‘</button>
        <p style="color: #aaa; margin-top: 20px; font-size: 14px;">Î ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½ ÏŒÎ»Î¿Î¹...</p>
    </div>

    <div id="turn-indicator">Î‘Î½Î±Î¼Î¿Î½Î®...</div>

    <div id="table">
        <div id="opp-top" class="opponent opp-top"></div>
        <div id="opp-left" class="opponent opp-left"></div>
        <div id="opp-right" class="opponent opp-right"></div>

        <div class="center-stack">
            <div class="card back" onclick="drawCardEffect()">
                <div style="font-size: 12px; color: #ddd; text-align: center;">Î¤Î¡Î‘Î’Î‘</div>
            </div>
            <div id="top-card-spot"></div>
        </div>

        <div id="controls">
            <button class="action-btn" onclick="socket.emit('passTurn')">Î Î‘Î£ÎŸ â­ï¸</button>
        </div>

        <div id="my-hand"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myId = null;

        // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Î¿Ï… ID Î¼Î¿Ï… ÏŒÏ„Î±Î½ ÏƒÏ…Î½Î´ÎµÎ¸Ï
        socket.on('connect', () => { 
            myId = socket.id; 
            console.log("Connected with ID:", myId);
        });

        // ÎŒÏ„Î±Î½ Ï„Î¿ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ Î¾ÎµÎºÎ¹Î½Î¬ÎµÎ¹
        socket.on('gameReady', () => {
            document.getElementById('start-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('start-screen').style.display = 'none';
            }, 500);
        });

        // ÎšÎ¥Î¡Î™Î‘ Î•ÎÎ—ÎœÎ•Î¡Î©Î£Î— (Î¤ÏÎ­Ï‡ÎµÎ¹ ÎºÎ¬Î¸Îµ Ï†Î¿ÏÎ¬ Ï€Î¿Ï… Ï€Î±Î¯Î¶ÎµÎ¹ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚)
        socket.on('updateUI', (data) => {
            // 1. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· ÎˆÎ½Î´ÎµÎ¹Î¾Î·Ï‚ Î£ÎµÎ¹ÏÎ¬Ï‚
            updateTurnIndicator(data.isMyTurn, data.penalty);

            // 2. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î¦ÏÎ»Î»Î¿Ï… ÎšÎ¬Ï„Ï‰
            if (data.topCard) {
                document.getElementById('top-card-spot').innerHTML = createCardHTML(data.topCard);
            }

            // 3. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Ï‰Î½ Î¦ÏÎ»Î»Ï‰Î½ Î¼Î¿Ï…
            if (data.myHand) {
                renderMyHand(data.myHand);
            }

            // 4. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î‘Î½Ï„Î¹Ï€Î¬Î»Ï‰Î½
            renderOpponents(data.players);
        });

        // Î•Î™Î”Î™ÎšÎ‘ ÎœÎ—ÎÎ¥ÎœÎ‘Î¤Î‘ (Ï€.Ï‡. ÎÎ±Î½Î±Ï€Î±Î¯Î¶ÎµÎ¹Ï‚)
        socket.on('notification', (msg) => {
            const indicator = document.getElementById('turn-indicator');
            indicator.innerText = msg;
            indicator.style.color = "#FFD700"; // Î§ÏÏ…ÏƒÏŒ
            indicator.style.borderColor = "#FFD700";
            
            // Î‰Ï‡Î¿Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬)
            // new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg').play();
        });

        // Î›Î‘Î˜ÎŸÎ£ ÎšÎ™ÎÎ—Î£Î— (ÎšÎ¿ÎºÎºÎ¯Î½Î¹ÏƒÎ¼Î±)
        socket.on('invalidMove', () => {
            const cards = document.querySelectorAll('.hand-card');
            cards.forEach(c => c.classList.add('shake'));
            
            // Î‘Ï†Î±Î¯ÏÎµÏƒÎ· Ï„Î·Ï‚ ÎºÎ»Î¬ÏƒÎ·Ï‚ Î¼ÎµÏ„Î¬ Ï„Î¿ animation
            setTimeout(() => {
                cards.forEach(c => c.classList.remove('shake'));
            }, 500);

            // ÎœÎ®Î½Ï…Î¼Î±
            const indicator = document.getElementById('turn-indicator');
            let oldText = indicator.innerText;
            indicator.innerText = "â›” Î›Î‘Î˜ÎŸÎ£ Î¦Î¥Î›Î›ÎŸ!";
            indicator.style.background = "#800";
            setTimeout(() => {
                indicator.innerText = oldText; // Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬
                indicator.style.background = "rgba(0,0,0,0.8)";
            }, 1000);
        });

        // --- Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ ---

        function updateTurnIndicator(isMyTurn, penalty) {
            const indicator = document.getElementById('turn-indicator');
            if (isMyTurn) {
                indicator.innerText = "ğŸŸ¢ Î•Î™ÎÎ‘Î™ Î— Î£Î•Î™Î¡Î‘ Î£ÎŸÎ¥!";
                indicator.style.color = "#4ff";
                indicator.style.borderColor = "#4ff";
                if (penalty > 0) {
                    indicator.innerText += ` (Î ÎŸÎ™ÎÎ—: +${penalty})`;
                    indicator.style.color = "#f55";
                }
            } else {
                indicator.innerText = "â³ Î ÎµÏÎ¯Î¼ÎµÎ½Îµ...";
                indicator.style.color = "#aaa";
                indicator.style.borderColor = "#555";
            }
        }

        function play(index) {
            socket.emit('playCard', index);
        }

        function drawCardEffect() {
            // ÎŸÏ€Ï„Î¹ÎºÏŒ ÎµÏ†Î­ Ï€Î±Ï„Î®Î¼Î±Ï„Î¿Ï‚
            socket.emit('drawCard');
        }

        function renderMyHand(hand) {
            const handDiv = document.getElementById('my-hand');
            handDiv.innerHTML = hand.map((card, index) => {
                const colorClass = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'red' : '';
                // Î•Î¹Î´Î¹ÎºÏŒÏ‚ ÏƒÏ‡ÎµÎ´Î¹Î±ÏƒÎ¼ÏŒÏ‚ Î³Î¹Î± Ï„Î¿ HTML Ï„Î¿Ï… ÎºÎ¬Î¸Îµ Ï†ÏÎ»Î»Î¿Ï…
                return `
                <div class="card hand-card ${colorClass}" onclick="play(${index})">
                    <div class="corner-top">${card.value}<br>${card.suit}</div>
                    <div class="suit-center">${card.suit}</div>
                    <div class="corner-bottom">${card.value}<br>${card.suit}</div>
                </div>`;
            }).join('');
        }

        function createCardHTML(card) {
            const colorClass = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'red' : '';
            return `
            <div class="card ${colorClass}">
                <div class="corner-top">${card.value}<br>${card.suit}</div>
                <div class="suit-center">${card.suit}</div>
                <div class="corner-bottom">${card.value}<br>${card.suit}</div>
            </div>`;
        }

        function renderOpponents(players) {
            // Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¿Ï…Î¼Îµ Î³Î¹Î± Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Ï„Î¿Ï…Ï‚ Î¬Î»Î»Î¿Ï…Ï‚ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ (ÏŒÏ‡Î¹ ÎµÎ¼Î­Î½Î±)
            const others = players.filter(p => p.id !== myId);
            const positions = ['opp-top', 'opp-left', 'opp-right'];
            
            // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Î¸Î­ÏƒÎµÏ‰Î½
            positions.forEach(pos => document.getElementById(pos).innerHTML = '');

            others.forEach((p, i) => {
                if (i < 3) { // Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î¼Î­Ï‡ÏÎ¹ 3 Î±Î½Ï„Î¹Ï€Î¬Î»Î¿Ï…Ï‚ (+ ÎµÏƒÎ­Î½Î± = 4)
                    const posId = positions[i];
                    
                    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î¼Î¹ÎºÏÏÎ½ ÎºÎ±ÏÏ„ÏÎ½ (Ï€Î»Î¬Ï„Î·)
                    let cardsHTML = '';
                    for(let k=0; k<p.handCount; k++) {
                        cardsHTML += '<div class="mini-card"></div>';
                    }

                    const html = `
                        <div class="opp-name">${p.name} (${p.handCount})</div>
                        <div class="mini-hand">
                            ${cardsHTML}
                        </div>
                    `;
                    document.getElementById(posId).innerHTML = html;
                }
            });
        }
    </script>
</body>
</html>
