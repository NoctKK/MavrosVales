<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÎœÎ±ÏÏÎ¿Ï‚ Î’Î±Î»Î­Ï‚</title>
    <style>
        :root { --green: #1a472a; --gold: #d4af37; --bg: radial-gradient(circle, #2e5c3e 0%, #1a472a 100%); }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; user-select: none; }

        /* Start Screen */
        #start-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .start-btn { padding: 20px 50px; font-size: 22px; background: var(--gold); border: none; border-radius: 50px; cursor: pointer; font-weight: bold; }

        /* Ace Selection Modal */
        #ace-modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 3000; 
            flex-direction: column; align-items: center; justify-content: center; 
        }
        .suit-options { display: flex; gap: 20px; margin-top: 20px; }
        .suit-btn { 
            width: 60px; height: 60px; font-size: 30px; background: white; border: 2px solid var(--gold); 
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; 
        }
        .suit-btn:hover { transform: scale(1.1); }

        /* Indicators */
        #turn-indicator {
            position: fixed; top: 15px; left: 50%; transform: translateX(-50%);
            padding: 10px 25px; background: rgba(0,0,0,0.8); border: 2px solid #555; border-radius: 20px;
            font-size: 16px; font-weight: bold; z-index: 1000;
        }
        #declared-suit {
            position: absolute; top: 35%; left: 50%; transform: translate(-50%, -50%);
            font-size: 40px; color: var(--gold); text-shadow: 0 0 10px black; display: none;
        }

        /* Table */
        #table { width: 100%; height: 100%; position: relative; }
        
        .center-stack { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 30px; }
        
        /* Opponents */
        .opponent { position: absolute; text-align: center; }
        .opp-top { top: 60px; left: 50%; transform: translateX(-50%); }
        .opp-left { left: 20px; top: 40%; transform: translateY(-50%); }
        .opp-right { right: 20px; top: 40%; transform: translateY(-50%); }
        .mini-card { width: 25px; height: 38px; background: #a00; border: 1px solid white; margin-left: -18px; display: inline-block; }

        /* Cards */
        .card {
            width: 80px; height: 120px; background: white; color: black; border-radius: 8px; border: 1px solid #999;
            display: flex; flex-direction: column; justify-content: space-between; padding: 5px; box-sizing: border-box;
            position: relative; font-weight: bold; font-size: 18px; box-shadow: 2px 4px 10px rgba(0,0,0,0.4);
            cursor: pointer;
        }
        .card.red { color: #d00; }
        .card.back { background: linear-gradient(135deg, #8e2424, #4d0000); border: 2px solid white; color: white; text-align: center; justify-content: center;}
        
        /* Hand */
        #my-hand { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; height: 140px; }
        .hand-card { margin-left: -45px; transition: 0.2s; }
        .hand-card:hover { transform: translateY(-30px); z-index: 100; }

        .shake { animation: shake 0.4s; border: 2px solid red !important; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

        /* Controls */
        #controls { position: absolute; bottom: 180px; right: 20px; display: flex; flex-direction: column; gap: 10px; }
        .action-btn { padding: 12px 25px; background: rgba(0,0,0,0.6); color: white; border: 1px solid var(--gold); border-radius: 25px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color: var(--gold);">ÎœÎ±ÏÏÎ¿Ï‚ Î’Î±Î»Î­Ï‚</h1>
        <button class="start-btn" onclick="socket.emit('startGameRequest')">ÎÎ•ÎšÎ™ÎÎ—Î£Î•</button>
    </div>

    <div id="turn-indicator">Î‘Î½Î±Î¼Î¿Î½Î®...</div>
    
    <div id="declared-suit"></div>

    <div id="ace-modal">
        <h2 style="color: white;">Î•Ï€Î¯Î»ÎµÎ¾Îµ Î§ÏÏÎ¼Î±</h2>
        <div class="suit-options">
            <div class="suit-btn" style="color: red;" onclick="confirmAce('â™¥')">â™¥</div>
            <div class="suit-btn" style="color: red;" onclick="confirmAce('â™¦')">â™¦</div>
            <div class="suit-btn" style="color: black;" onclick="confirmAce('â™£')">â™£</div>
            <div class="suit-btn" style="color: black;" onclick="confirmAce('â™ ')">â™ </div>
        </div>
        <button class="action-btn" style="margin-top: 20px;" onclick="confirmAce(null)">Î§Ï‰ÏÎ¯Ï‚ Î‘Î»Î»Î±Î³Î®</button>
    </div>

    <div id="table">
        <div id="opp-top" class="opponent opp-top"></div>
        <div id="opp-left" class="opponent opp-left"></div>
        <div id="opp-right" class="opponent opp-right"></div>

        <div class="center-stack">
            <div class="card back" id="draw-pile" onclick="socket.emit('drawCard')">
                <div>Î¤Î¡Î‘Î’Î‘</div>
            </div>
            <div id="top-card-spot"></div>
        </div>

        <div id="controls">
            <button class="action-btn" onclick="socket.emit('passTurn')">Î Î‘Î£ÎŸ</button>
        </div>

        <div id="my-hand"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myId = null;
        let selectedAceIndex = null; // ÎšÏÎ±Ï„Î¬Î¼Îµ Ï€Î¿Î¹Î¿Î½ Î†ÏƒÏƒÎ¿ Ï€Î¬Ï„Î·ÏƒÎµ

        socket.on('connect', () => myId = socket.id);
        socket.on('gameReady', () => document.getElementById('start-screen').style.display = 'none');

        socket.on('updateUI', (data) => {
            // ÎˆÎ½Î´ÎµÎ¹Î¾Î· Î£ÎµÎ¹ÏÎ¬Ï‚ & Î Î¿Î¹Î½Î®Ï‚
            const indicator = document.getElementById('turn-indicator');
            const drawPile = document.getElementById('draw-pile');
            
            if (data.isMyTurn) {
                if (data.penalty > 0) {
                    indicator.innerText = `âš ï¸ Î¤Î¡Î‘Î’Î‘ ${data.penalty} ÎšÎ‘Î¡Î¤Î•Î£!`;
                    indicator.style.color = "#ff5555";
                    drawPile.style.boxShadow = "0 0 20px red";
                    drawPile.innerHTML = `<div style="font-size:20px">${data.penalty}</div><div>ÎšÎ‘Î¡Î¤Î•Î£</div>`;
                } else {
                    indicator.innerText = "ğŸŸ¢ Î•Î™ÎÎ‘Î™ Î— Î£Î•Î™Î¡Î‘ Î£ÎŸÎ¥";
                    indicator.style.color = "#4ff";
                    drawPile.style.boxShadow = "none";
                    drawPile.innerHTML = `<div>Î¤Î¡Î‘Î’Î‘</div>`;
                }
            } else {
                indicator.innerText = "â³ Î ÎµÏÎ¯Î¼ÎµÎ½Îµ...";
                indicator.style.color = "#aaa";
                drawPile.style.boxShadow = "none";
                drawPile.innerHTML = `<div>Î¤Î¡Î‘Î’Î‘</div>`;
            }

            // Î§ÏÏÎ¼Î± Î†ÏƒÏƒÎ¿Ï…
            const suitDiv = document.getElementById('declared-suit');
            if (data.activeSuit) {
                suitDiv.innerText = data.activeSuit;
                suitDiv.style.color = (data.activeSuit === 'â™¥' || data.activeSuit === 'â™¦') ? 'red' : 'black'; // Î•Î´Ï Ï†Ï„Î¹Î¬Î¾Î±Î¼Îµ Ï„Î¿ Ï‡ÏÏÎ¼Î± Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏƒÏ‰ÏƒÏ„Î¬
                suitDiv.style.backgroundColor = "white"; // Î¦ÏŒÎ½Ï„Î¿ Î³Î¹Î± Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Ï„Î¿ Î¼Î±ÏÏÎ¿
                suitDiv.style.borderRadius = "50%";
                suitDiv.style.width = "50px";
                suitDiv.style.height = "50px";
                suitDiv.style.display = "flex";
                suitDiv.style.alignItems = "center";
                suitDiv.style.justifyContent = "center";
            } else {
                suitDiv.style.display = "none";
            }

            // Î¦ÏÎ»Î»Î±
            if (data.topCard) document.getElementById('top-card-spot').innerHTML = createCardHTML(data.topCard);
            if (data.myHand) renderMyHand(data.myHand);
            renderOpponents(data.players);
        });

        socket.on('notification', (msg) => {
            const ind = document.getElementById('turn-indicator');
            ind.innerText = msg;
            ind.style.color = "gold";
            setTimeout(() => { /* Î˜Î± ÎµÏ€Î±Î½Î­Î»Î¸ÎµÎ¹ Î¼Îµ Ï„Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ update */ }, 2000);
        });

        socket.on('invalidMove', () => {
            document.querySelectorAll('.hand-card').forEach(c => c.classList.add('shake'));
            setTimeout(() => document.querySelectorAll('.hand-card').forEach(c => c.classList.remove('shake')), 500);
        });

        // --- Î›Î•Î™Î¤ÎŸÎ¥Î¡Î“Î™Î•Î£ ---

        function play(index, cardValue) {
            // Î‘Î½ ÎµÎ¯Î½Î±Î¹ Î†ÏƒÏƒÎ¿Ï‚, Î±Î½Î¿Î¯Î³Î¿Ï…Î¼Îµ Ï„Î¿ Ï€Î±ÏÎ¬Î¸Ï…ÏÎ¿ ÎµÏ€Î¹Î»Î¿Î³Î®Ï‚
            if (cardValue === 'A') {
                selectedAceIndex = index;
                document.getElementById('ace-modal').style.display = 'flex';
            } else {
                // ÎšÎ±Î½Î¿Î½Î¹ÎºÏŒ Ï€Î±Î¯Î¾Î¹Î¼Î¿
                socket.emit('playCard', { index: index, declaredSuit: null });
            }
        }

        function confirmAce(suit) {
            // ÎšÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï… ÎºÎ±Î¹ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®
            document.getElementById('ace-modal').style.display = 'none';
            socket.emit('playCard', { index: selectedAceIndex, declaredSuit: suit });
            selectedAceIndex = null;
        }

        function renderMyHand(hand) {
            document.getElementById('my-hand').innerHTML = hand.map((c, i) => {
                const color = (c.suit === 'â™¥' || c.suit === 'â™¦') ? 'red' : '';
                // Î ÎµÏÎ½Î¬Î¼Îµ Ï„Î¿ value ÏƒÏ„Î·Î½ play() Î³Î¹Î± Î½Î± Î¾Î­ÏÎµÎ¹ Î±Î½ ÎµÎ¯Î½Î±Î¹ Î†ÏƒÏƒÎ¿Ï‚
                return `<div class="card hand-card ${color}" onclick="play(${i}, '${c.value}')">
                    <div style="line-height:0.8">${c.value}<br>${c.suit}</div>
                    <div style="font-size:35px; align-self:center">${c.suit}</div>
                    <div style="transform:rotate(180deg); line-height:0.8">${c.value}<br>${c.suit}</div>
                </div>`;
            }).join('');
        }

        function createCardHTML(c) {
            const color = (c.suit === 'â™¥' || c.suit === 'â™¦') ? 'red' : '';
            return `<div class="card ${color}">
                <div style="line-height:0.8">${c.value}<br>${c.suit}</div>
                <div style="font-size:35px; align-self:center">${c.suit}</div>
                <div style="transform:rotate(180deg); line-height:0.8">${c.value}<br>${c.suit}</div>
            </div>`;
        }

        function renderOpponents(players) {
            const others = players.filter(p => p.id !== myId);
            const pos = ['opp-top', 'opp-left', 'opp-right'];
            pos.forEach(p => document.getElementById(p).innerHTML = '');
            others.forEach((p, i) => {
                if(i<3) {
                    let cards = '';
                    for(let k=0; k<p.handCount; k++) cards += '<div class="mini-card"></div>';
                    document.getElementById(pos[i]).innerHTML = `
                        <div style="background:rgba(0,0,0,0.5); padding:2px 8px; border-radius:5px; margin-bottom:5px;">${p.name}</div>
                        <div>${cards}</div>`;
                }
            });
        }
    </script>
</body>
</html>
