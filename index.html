<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎœÎ±ÏÏÎ¿Ï‚ Î’Î±Î»Î­Ï‚</title>
    <style>
        :root { --green: #1a472a; --gold: #d4af37; --red-glow: rgba(255, 0, 0, 0.8); }
        body { background-color: var(--green); color: white; font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; user-select: none; }

        /* Start Screen */
        #start-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        button.start-btn { padding: 20px 50px; font-size: 24px; background: var(--gold); border: none; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 0 20px var(--gold); }

        /* Turn Indicator */
        #turn-indicator {
            position: fixed; top: 20px; right: 20px;
            padding: 10px 20px; background: rgba(0,0,0,0.7);
            border: 2px solid #555; border-radius: 10px;
            font-size: 18px; font-weight: bold; transition: 0.3s;
        }

        /* Table Layout */
        #table { width: 100%; height: 100%; position: relative; }

        /* Opponents */
        .opponent { position: absolute; display: flex; flex-direction: column; align-items: center; }
        .opp-top { top: 20px; left: 50%; transform: translateX(-50%); }
        .opp-left { left: 30px; top: 40%; transform: translateY(-50%) rotate(90deg); }
        .opp-right { right: 30px; top: 40%; transform: translateY(-50%) rotate(-90deg); }
        
        .mini-card { width: 20px; height: 30px; background: #800; border: 1px solid white; border-radius: 2px; margin-left: -15px; }
        
        /* Center Deck */
        .center-stack {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            display: flex; gap: 40px; align-items: center;
        }
        
        /* Card Styles */
        .card {
            width: 80px; height: 120px;
            background: white; color: black;
            border-radius: 8px; border: 2px solid #222;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 5px; box-sizing: border-box;
            position: relative; font-weight: bold; font-size: 18px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.5);
            cursor: pointer; transition: transform 0.2s;
        }
        .card.red { color: #d00; }
        .card.back { background: linear-gradient(135deg, #a00, #500); border: 2px solid #fff; }
        .card:hover { transform: translateY(-10px); }

        /* Invalid Move Animation */
        .shake { animation: shake 0.4s; border-color: red !important; box-shadow: 0 0 15px red; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 100% { transform: translateX(0); } }

        /* Player Hand */
        #my-hand {
            position: absolute; bottom: 20px; width: 100%;
            display: flex; justify-content: center; height: 140px;
        }
        .hand-card { margin-left: -40px; transition: 0.2s; }
        .hand-card:hover { margin-left: -10px; margin-right: 30px; z-index: 100; transform: translateY(-30px) scale(1.1); }

        /* Controls */
        #controls { position: absolute; bottom: 180px; right: 40px; display: flex; gap: 10px; }
        .action-btn { padding: 10px 20px; background: #333; color: white; border: 1px solid white; border-radius: 20px; cursor: pointer; }
        .action-btn:hover { background: #555; }

    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color: var(--gold); margin-bottom: 20px;">ÎœÎ±ÏÏÎ¿Ï‚ Î’Î±Î»Î­Ï‚</h1>
        <button class="start-btn" onclick="socket.emit('startGameRequest')">ÎÎ•ÎšÎ™ÎÎ—Î£Î• Î¤ÎŸ ÎœÎŸÎ™Î¡Î‘Î£ÎœÎ‘</button>
        <p style="color: #ccc; margin-top: 10px;">Î ÎµÏÎ¯Î¼ÎµÎ½Îµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸Î¿ÏÎ½ ÏŒÎ»Î¿Î¹ Î¿Î¹ Ï†Î¯Î»Î¿Î¹ ÏƒÎ¿Ï… Ï€ÏÏÏ„Î±!</p>
    </div>

    <div id="turn-indicator">Î‘Î½Î±Î¼Î¿Î½Î®...</div>

    <div id="table">
        <div id="opp-top" class="opponent opp-top"></div>
        <div id="opp-left" class="opponent opp-left"></div>
        <div id="opp-right" class="opponent opp-right"></div>

        <div class="center-stack">
            <div class="card back" onclick="socket.emit('drawCard')">
                <div style="font-size: 10px; text-align: center; color: white; margin-top: 40%;">Î¤Î¡Î‘Î’Î‘</div>
            </div>
            <div id="top-card-spot"></div>
        </div>

        <div id="controls">
            <button class="action-btn" onclick="socket.emit('passTurn')">Î Î‘Î£ÎŸ</button>
        </div>

        <div id="my-hand"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let myId = null;

        socket.on('connect', () => { myId = socket.id; });

        // ÎˆÎ½Î±ÏÎ¾Î· Ï€Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï: ÎšÏÏÏˆÎµ Ï„Î·Î½ Î¿Î¸ÏŒÎ½Î· Î­Î½Î±ÏÎ¾Î·Ï‚
        socket.on('gameReady', () => {
            document.getElementById('start-screen').style.display = 'none';
        });

        // ÎšÏÏÎ¹Î± Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· UI
        socket.on('updateUI', (data) => {
            // 1. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î£ÎµÎ¹ÏÎ¬Ï‚
            const indicator = document.getElementById('turn-indicator');
            if (data.isMyTurn) {
                indicator.innerText = "ğŸŸ¢ Î•Î™ÎÎ‘Î™ Î— Î£Î•Î™Î¡Î‘ Î£ÎŸÎ¥!";
                indicator.style.borderColor = "#0f0";
                indicator.style.color = "#0f0";
            } else {
                indicator.innerText = "ğŸ”´ Î ÎµÏÎ¯Î¼ÎµÎ½Îµ...";
                indicator.style.borderColor = "#555";
                indicator.style.color = "#ccc";
            }

            // 2. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î¦ÏÎ»Î»Î¿Ï… ÎšÎ¬Ï„Ï‰
            if (data.topCard) {
                document.getElementById('top-card-spot').innerHTML = createCardHTML(data.topCard);
            }

            // 3. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î§ÎµÏÎ¹Î¿Ï ÎœÎ¿Ï…
            if (data.myHand) {
                const handDiv = document.getElementById('my-hand');
                handDiv.innerHTML = data.myHand.map((card, index) => {
                    const colorClass = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'red' : '';
                    return `
                    <div class="card hand-card ${colorClass}" onclick="play(${index})">
                        <div>${card.value}${card.suit}</div>
                        <div style="font-size: 35px; text-align: center;">${card.suit}</div>
                        <div style="transform: rotate(180deg); text-align: right;">${card.value}${card.suit}</div>
                    </div>`;
                }).join('');
            }

            // 4. Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Î‘Î½Ï„Î¹Ï€Î¬Î»Ï‰Î½
            renderOpponents(data.players);
        });

        // Î‘Î½ Î­ÏÎ¸ÎµÎ¹ Ï†ÏÎ»Î»Î¿ Î­Î½Î±-Î­Î½Î± (ÎºÎ±Ï„Î¬ Ï„Î¿ Î¼Î¿Î¯ÏÎ±ÏƒÎ¼Î±)
        socket.on('receiveCard', (card) => {
            // Î‘Ï€Î»Î¬ Î±Î½Î±Î½ÎµÏÎ½Î¿Ï…Î¼Îµ Ï„Î¿ UI ÏŒÏ„Î±Î½ Î­ÏÏ‡ÎµÏ„Î±Î¹ Ï„Î¿ updateUI, ÎµÎ´Ï Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î²Î¬Î»Î¿Ï…Î¼Îµ Î®Ï‡Î¿ Î¼ÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ¬
        });

        // Î›Î‘Î˜ÎŸÎ£ ÎšÎ™ÎÎ—Î£Î— (ÎšÎ¿ÎºÎºÎ¯Î½Î¹ÏƒÎ¼Î±)
        socket.on('invalidMove', () => {
            const cards = document.querySelectorAll('.hand-card');
            cards.forEach(c => c.classList.add('shake'));
            setTimeout(() => cards.forEach(c => c.classList.remove('shake')), 500);
            
            // Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬: Î‰Ï‡Î¿Ï‚ Î»Î¬Î¸Î¿Ï…Ï‚
            // new Audio('error.mp3').play(); 
        });

        function play(index) {
            socket.emit('playCard', index);
        }

        function createCardHTML(card) {
            const colorClass = (card.suit === 'â™¥' || card.suit === 'â™¦') ? 'red' : '';
            return `
            <div class="card ${colorClass}">
                <div>${card.value}${card.suit}</div>
                <div style="font-size: 35px; text-align: center;">${card.suit}</div>
                <div style="transform: rotate(180deg); text-align: right;">${card.value}${card.suit}</div>
            </div>`;
        }

        function renderOpponents(players) {
            const others = players.filter(p => p.id !== myId);
            const positions = ['opp-top', 'opp-left', 'opp-right'];
            
            positions.forEach(pos => document.getElementById(pos).innerHTML = ''); // ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚

            others.forEach((p, i) => {
                if (i < 3) { // ÎœÎ­Ï‡ÏÎ¹ 3 Î±Î½Ï„Î¹Ï€Î¬Î»Î¿Ï…Ï‚
                    const html = `
                        <div style="background: rgba(0,0,0,0.5); padding: 5px; border-radius: 5px; margin-bottom: 5px;">
                            ${p.name}
                        </div>
                        <div style="display: flex; margin-left: 20px;">
                            ${Array(p.handCount).fill('<div class="mini-card"></div>').join('')}
                        </div>
                    `;
                    document.getElementById(positions[i]).innerHTML = html;
                }
            });
        }
    </script>
</body>
</html>
